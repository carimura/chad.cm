<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Personal website of Chad Arimura - Getting jpackage to Work with CrowdStrike">
<title>Chad Arimura | Getting jpackage to Work with CrowdStrike</title>
<link rel="stylesheet" href="/assets/styles.css">
<link rel="alternate" type="application/rss+xml" title="The Site of Chad Arimura" href="/feed.xml">
<script src="/assets/javascript/theme.js"></script>
<script src="/assets/javascript/main.js"></script>
<script src="https://cdn.usefathom.com/script.js" data-site="AVAPMDCM" defer></script>
</head>
<body>
    <header>
        <div class="container">
            <div id="site-title">
    <a href="/">Chad Arimura</a>
</div>

<nav id="site-nav">
    <ul>
        <li title="Home"><a href="/" class="nav-link ">Home</a></li>
        <li title="About Me"><a href="/about.html" class="nav-link ">About Me</a></li>
        <li title="Writing"><a href="/writing.html" class="nav-link active">Writing</a></li>
        <li title="Speaking"><a href="/speaking.html" class="nav-link ">Speaking</a></li>
    </ul>
</nav>

<button id="theme-toggle" class="theme-toggle" aria-label="Switch to dark mode">
    üåô
</button>
        </div>
    </header>

    <main class="container" id="post">
        <article class="post">
            <div id="post-header">
                <p id="date">October 10th, 2025</p>
                <h1 class="post-title">Getting jpackage to Work with CrowdStrike</h1>
            </div>
            
            <div id="post-content">
                <p>I wrote a <a href="https://github.com/carimura/gus">small terminal agent called Gus</a> in Java named after one of my dogs (the big one) to play around with building agents and using tools and stuff. I might rename it to arc but that's my <a href="https://chad.cm/posts/2025-05-28-building-arc">static site generator</a>. I think the name arc is cooler, whereas Gus is more for loafing around with the chickens and looking homeless. I digress.</p>
<p>I discovered the hard way that because CrowdStrike is installed on my machine, I couldn't run apps built with <code>jpackage</code>, which is Java's packaging tool to bundle a runtime with your app and produce a native package. I use this for command-line stuff in Java. Like Arc. And Gus. Everything was fine on my home machine. Until they met my work machine. CrowdStrike would kill my app and quarantine the executable file. I'm guessing our IT group will provide an exception for me, but I felt like learning more so I dove in.</p>
<p>This blog post is for me, so I can repeat this.</p>
<h2>The Problem</h2>
<p>The problem is because running a jpackage-built app results in the process being killed immediately:</p>
<pre><code class="language-bash">./output/Hello.app/Contents/MacOS/Hello
[1]    30464 killed     ./output/Hello.app/Contents/MacOS/Hello
</code></pre>
<p>CrowdStrike Falcon quarantines the executable because of a file called <code>libjli.dylib</code>, which by default with jpackage is an &quot;ad-hoc&quot; signed binary (<code>codesign -s -</code>). Apparently this isn't very trustworthy. Like Gus himself. The real Gus has been licking his lips around the baby chickens. The protector becomes the aggressor.</p>
<h2>The Solution</h2>
<h3>1. Get an Apple Developer Certificate</h3>
<p>Once enrolled in the Apple Developer Program, you need to create a <strong>Developer ID Application</strong> certificate (not &quot;Apple Development&quot; or &quot;Mac App Distribution&quot;). This is specifically for signing apps distributed outside the Mac App Store.</p>
<h3>2. Create a Certificate Signing Request</h3>
<pre><code class="language-bash">openssl req -new -newkey rsa:2048 -nodes \
  -keyout DeveloperID.key \
  -out CertificateSigningRequest.certSigningRequest \
  -subj &quot;/emailAddress=you@example.com/CN=Your Name/C=US&quot;
</code></pre>
<p>Upload the <code>.certSigningRequest</code> file to Apple Developer portal, select G2 Sub-CA, and download the resulting <code>.cer</code> file.</p>
<h3>3. Import the Certificate</h3>
<pre><code class="language-bash"># Import the certificate
security import developerID_application.cer -k ~/Library/Keychains/login.keychain-db

# Import the private key
security import DeveloperID.key -k ~/Library/Keychains/login.keychain-db

# Download and import Apple's intermediate certificate
curl -O https://www.apple.com/certificateauthority/DeveloperIDG2CA.cer
security import DeveloperIDG2CA.cer -k ~/Library/Keychains/login.keychain-db

# Verify it's available
security find-identity -v -p codesigning
</code></pre>
<p>You should see your Developer ID Application identity listed.</p>
<h3>4. Create an Entitlements File</h3>
<p>The JVM requires specific entitlements to run with hardened runtime:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;com.apple.security.cs.disable-library-validation&lt;/key&gt;
    &lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>Save this as <code>entitlements.plist</code>.</p>
<h3>5. Build and Sign with jpackage</h3>
<pre><code class="language-bash">jpackage \
  --name Hello \
  --type app-image \
  --input /path/to/input \
  --main-jar Hello.jar \
  --dest /path/to/output \
  --runtime-image /path/to/runtime \
  --mac-sign \
  --mac-signing-key-user-name &quot;Developer ID Application: Your Name (TEAMID)&quot; \
  --verbose
</code></pre>
<p>If jpackage doesn't apply entitlements correctly, manually re-sign:</p>
<pre><code class="language-bash">codesign --force --sign &quot;Developer ID Application: Your Name (TEAMID)&quot; \
  --entitlements entitlements.plist \
  --deep --options runtime \
  output/Hello.app
</code></pre>
<h3>6. Verify the Signature</h3>
<pre><code class="language-bash">codesign -dv output/Hello.app/Contents/MacOS/Hello
codesign -d --entitlements - --xml output/Hello.app/Contents/MacOS/Hello
</code></pre>
<p>You should see your Developer ID signature and the entitlements listed.</p>
<h2>Boom</h2>
<pre><code class="language-bash">‚ùØ ./output/Hello.app/Contents/MacOS/Hello
Hello, Chad
</code></pre>
<p>Boom.</p>

            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
    <p class="made-with">Made with <a href="https://github.com/carimura/arc" target="_blank" rel="noopener">Arc</a></p>

    <div class="social-links">
        <a href="https://github.com/carimura" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
            <svg class="icon" viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
            </svg>
        </a>
        <a href="https://twitter.com/chadarimura" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
            <svg class="icon" viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
        </a>
        <a href="https://linkedin.com/in/chadarimura" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
            <svg class="icon" viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
        </a>
        <a href="/feed.xml" aria-label="RSS Feed">
            <svg class="icon" viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M5 3v3c7.732 0 14 6.268 14 14h3c0-9.374-7.626-17-17-17zm0 6v3c4.418 0 8 3.582 8 8h3c0-6.075-4.925-11-11-11zm4 8a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
        </a>
    </div>
</div>
        </div>
    </footer>
</body>
</html>